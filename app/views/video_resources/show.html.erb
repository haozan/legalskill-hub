<%# VIDEO DETAIL — Tech Agent dark UI %>
<div class="bg-surface min-h-screen">
  <!-- Breadcrumb -->
  <div class="border-b border-border bg-surface-elevated">
    <div class="container-xl mx-auto px-6 py-4">
      <nav class="flex items-center gap-2 text-xs font-mono text-muted">
        <%= link_to "HOME", root_path, class: "hover:text-primary transition-colors" %>
        <span class="text-border">/</span>
        <%= link_to "TRAINING", video_resources_path, class: "hover:text-primary transition-colors" %>
        <span class="text-border">/</span>
        <span class="text-primary truncate max-w-xs"><%= @video.title.upcase %></span>
      </nav>
    </div>
  </div>

  <div class="container-xl mx-auto px-6 py-10">
    <div class="max-w-5xl mx-auto">
      <!-- Video Header -->
      <div class="mb-6">
        <span class="skill-card-badge mb-4 inline-flex"><%= @video.category.name.upcase %></span>
        <div class="sys-label my-3">// VIDEO_RESOURCE</div>
        <h1 class="font-sans text-2xl md:text-3xl font-bold text-primary mb-5 leading-tight">
          <%= @video.title %>
        </h1>
        <div class="flex flex-wrap items-center gap-6 text-xs font-mono text-muted">
          <span class="flex items-center gap-1.5">
            <%= lucide_icon "eye", class: "w-3 h-3" %>
            <span><%= number_with_delimiter(@video.views_count) %> VIEWS</span>
          </span>
          <% if @video.duration.present? %>
            <span class="flex items-center gap-1.5">
              <%= lucide_icon "clock", class: "w-3 h-3" %>
              <span><%= @video.duration %></span>
            </span>
          <% end %>
          <span class="flex items-center gap-1.5">
            <%= lucide_icon "calendar", class: "w-3 h-3" %>
            <span><%= @video.created_at.strftime("%Y.%m.%d") %></span>
          </span>
        </div>
      </div>

      <!-- Video Player -->
      <%# 转换 Bilibili URL 为嵌入播放器URL（使用官方推荐格式） %>
      <% if @video.bilibili_url.present? %>
        <% bvid = @video.bilibili_url.gsub('https://www.bilibili.com/video/', '').gsub('/', '') %>
        <% embed_url = "//player.bilibili.com/player.html?isOutside=true&bvid=#{bvid}&page=1" %>
      <% else %>
        <% embed_url = nil %>
      <% end %>
      <div class="aspect-video bg-surface-elevated border border-border overflow-hidden mb-8">
        <% if embed_url.present? %>
          <iframe
            src="<%= embed_url %>"
            class="w-full h-full"
            scrolling="no"
            border="0"
            frameborder="no"
            framespacing="0"
            allowfullscreen="true">
          </iframe>
        <% else %>
          <div class="w-full h-full flex flex-col items-center justify-center gap-4 tech-grid-bg">
            <div class="w-16 h-16 border border-border flex items-center justify-center">
              <%= lucide_icon "video", class: "w-7 h-7 text-muted" %>
            </div>
            <p class="text-xs font-mono text-muted tracking-widest">VIDEO_PLAYER_UNAVAILABLE</p>
          </div>
        <% end %>
      </div>

      <!-- Description -->
      <div class="bg-surface-elevated border border-border p-6 mb-6">
        <div class="sys-label mb-4">// COURSE_OVERVIEW</div>
        <p class="text-secondary text-sm leading-relaxed">
          该视频课程由资深律师录制，深入浅出地讲解<%= @video.category.name %>领域的核心知识与实务技巧。
        </p>
      </div>

      <!-- Related Videos -->
      <% if @related_videos.any? %>
        <div class="mt-12 pt-8 border-t border-border">
          <div class="sys-label mb-4">// RELATED_CONTENT</div>
          <h2 class="font-sans text-lg font-bold text-primary mb-6">相关推荐</h2>
          <div class="grid md:grid-cols-3 gap-px bg-border">
            <% @related_videos.each do |video| %>
              <div class="video-card bg-surface-elevated">
                <div class="video-thumbnail">
                  <img src="<%= video.cover_image_url %>"
                       alt="<%= video.title %>"
                       class="w-full h-full object-cover"
                       referrerpolicy="no-referrer"
                       onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1505664194779-8beaceb93744?w=600&h=340&fit=crop&q=80';">
                  <%= link_to video_resource_path(video),
                        class: "absolute inset-0 flex items-center justify-center hover:bg-primary/5 transition-colors" do %>
                    <div class="w-10 h-10 border border-primary flex items-center justify-center bg-surface/80">
                      <%= lucide_icon "play", class: "w-4 h-4 text-primary ml-0.5" %>
                    </div>
                  <% end %>
                  <% if video.duration.present? %>
                    <div class="absolute top-2 right-2 px-2 py-0.5 bg-surface/90 border border-border text-xs font-mono text-muted">
                      <%= video.duration %>
                    </div>
                  <% end %>
                </div>
                <div class="p-4">
                  <%= link_to video_resource_path(video), class: "block group" do %>
                    <h3 class="font-sans text-sm font-medium text-primary group-hover:text-primary-light transition-colors line-clamp-2 mb-2">
                      <%= video.title %>
                    </h3>
                  <% end %>
                  <span class="text-xs font-mono text-muted flex items-center gap-1">
                    <%= lucide_icon "eye", class: "w-3 h-3" %>
                    <span><%= number_with_delimiter(video.views_count) %></span>
                  </span>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
